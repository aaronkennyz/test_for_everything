<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GigByCity - Procedural Graffiti Scroll</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Permanent+Marker&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            /* Hidden scrollbar for cleaner look, but still scrollable */
            -ms-overflow-style: none;
            scrollbar-width: none;
            /* Remove tap highlight on mobile */
            -webkit-tap-highlight-color: transparent;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        /* Glassmorphism for UI cards to maintain readability over noisy background */
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.4) inset;
        }

        .dark .glass-card {
            background: rgba(20, 20, 20, 0.85);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        }

        .dashed-line {
            background-image: linear-gradient(to right, #ccc 50%, rgba(255, 255, 255, 0) 0%);
            background-position: bottom;
            background-size: 8px 1px;
            background-repeat: repeat-x;
        }

        .dark .dashed-line {
            background-image: linear-gradient(to right, #444 50%, rgba(255, 255, 255, 0) 0%);
        }

        .inset-shadow {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .dark .inset-shadow {
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* For procedural graffiti text */
        .graffiti-font {
            font-family: 'Permanent Marker', cursive;
        }
    </style>
</head>

<body
    class="bg-white dark:bg-[#0a0a0a] text-gray-900 dark:text-gray-100 relative min-h-screen transition-colors duration-500">

    <!-- Fixed Background Container -->
    <div class="fixed inset-0 z-0 transition-opacity duration-500 pointer-events-none">
        <canvas id="graffiti-canvas" class="w-full h-full"></canvas>
    </div>

    <!-- UI Overlay (Mobile Layout Centered) -->
    <div class="relative z-10 w-full max-w-md mx-auto pt-4 pb-28 px-4 flex flex-col gap-5 sm:gap-6" id="app-content">

        <!-- Top Navigation -->
        <header class="flex justify-between items-center glass-card px-4 py-3 rounded-2xl">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-red-600 rotate-45"></div>
                <h1 class="font-bold text-lg tracking-tight dark:text-white">GigByCity</h1>
            </div>
            <div class="flex items-center gap-2 sm:gap-3">
                <button id="theme-toggle"
                    class="p-2 sm:p-2.5 rounded-full bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 transition-colors active:scale-95">
                    <svg id="theme-icon-dark" class="w-4 h-4 hidden dark:block" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z">
                        </path>
                    </svg>
                    <svg id="theme-icon-light" class="w-4 h-4 block dark:hidden" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                        </path>
                    </svg>
                </button>
                <span class="text-[10px] sm:text-xs font-bold tracking-wider dark:text-gray-300 uppercase">Aaron</span>
                <div
                    class="w-8 h-8 rounded-full overflow-hidden bg-gray-200 border border-gray-300 dark:border-gray-700">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aaron&backgroundColor=b6e3f4"
                        alt="User Avatar" class="w-full h-full object-cover">
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <!-- Added touch-action-manipulation for better mobile tapping -->
        <div
            class="w-full h-64 rounded-3xl overflow-hidden relative shadow-2xl group cursor-pointer active:scale-[0.98] transition-transform">
            <!-- md:group-hover keeps hover effect only on desktop -->
            <img src="https://images.unsplash.com/photo-1598387181032-a3103a2db5b3?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80"
                alt="The Beatles"
                class="w-full h-full object-cover md:group-hover:scale-105 transition-transform duration-700">
            <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-black/40 to-black/10"></div>
            <div class="absolute inset-0 p-5 sm:p-6 flex flex-col justify-end">
                <span class="text-white/70 text-xs font-bold tracking-widest mb-1">UP NEXT</span>
                <!-- Scaled text down slightly for narrow mobile -->
                <h2 class="text-white text-3xl sm:text-4xl font-extrabold tracking-tight mb-2">THE<br>BEATLES</h2>
                <div class="flex items-center gap-2">
                    <div class="w-1 h-4 bg-red-600"></div>
                    <p class="text-white/90 text-sm">Relive the beatles era.</p>
                </div>
            </div>
            <!-- Pagination dots -->
            <div class="absolute bottom-4 right-4 flex gap-1">
                <div class="w-4 h-1 rounded-full bg-white"></div>
                <div class="w-1 h-1 rounded-full bg-white/50"></div>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="flex gap-2 sm:gap-3">
            <div class="flex-1 glass-card flex items-center px-4 py-3 rounded-full">
                <svg class="w-5 h-5 text-gray-400 dark:text-gray-500 mr-2 shrink-0" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" placeholder="Search events..."
                    class="bg-transparent border-none outline-none w-full text-sm font-medium text-gray-700 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500">
            </div>
            <button
                class="glass-card w-12 h-12 flex items-center justify-center rounded-full shrink-0 active:bg-gray-200 dark:active:bg-gray-800 transition-colors">
                <svg class="w-5 h-5 text-gray-700 dark:text-gray-300" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z">
                    </path>
                </svg>
            </button>
        </div>

        <!-- Event Cards Container (Populated by JS to enable endless scrolling) -->
        <div id="events-container" class="flex flex-col gap-5 sm:gap-6">
            <!-- First Card matches screenshot -->
            <div class="glass-card rounded-3xl p-5 sm:p-6 relative">
                <!-- Barcode overlay top right -->
                <div class="absolute top-6 right-6 flex flex-col items-end opacity-20 dark:opacity-40">
                    <div class="flex gap-[2px] h-8">
                        <div class="w-1 bg-black dark:bg-white h-full"></div>
                        <div class="w-2 bg-black dark:bg-white h-full"></div>
                        <div class="w-1 bg-black dark:bg-white h-full"></div>
                        <div class="w-[2px] bg-black dark:bg-white h-full"></div>
                        <div class="w-1 bg-black dark:bg-white h-full"></div>
                        <div class="w-2 bg-black dark:bg-white h-full"></div>
                        <div class="w-1 bg-black dark:bg-white h-full"></div>
                    </div>
                    <span class="text-[8px] tracking-[0.2em] font-mono mt-1 dark:text-gray-300">0 8 3</span>
                </div>

                <h3 class="text-xl font-bold mb-3 text-gray-900 dark:text-white">Play this game</h3>
                <!-- Flex wrap for tiny screens so text doesn't overflow -->
                <div class="flex items-center flex-wrap gap-2 mb-4 pr-10">
                    <svg class="w-3 h-3 text-red-500 shrink-0" viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z" />
                    </svg>
                    <a href="#"
                        class="text-[10px] sm:text-xs font-mono font-bold text-gray-600 dark:text-gray-400 md:hover:text-black dark:md:hover:text-white truncate max-w-[160px] sm:max-w-full">shawnrun.vercel.app/</a>
                    <span
                        class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-[10px] font-bold text-gray-500 dark:text-gray-400 tracking-wider shrink-0">PARTY</span>
                </div>

                <p class="text-sm text-gray-600 dark:text-gray-300 mb-6 sm:mb-8 font-medium">Drunkness</p>

                <!-- Ticket details section -->
                <div class="relative pt-6">
                    <!-- Dashed line separator -->
                    <!-- Adjusted positioning slightly for varying paddings -->
                    <div
                        class="absolute top-0 left-[-20px] sm:left-[-24px] right-[-20px] sm:right-[-24px] h-[1px] dashed-line">
                    </div>
                    <!-- Cutouts for ticket effect -->
                    <div
                        class="absolute top-[-10px] left-[-30px] sm:left-[-34px] w-5 h-5 bg-gray-200/50 dark:bg-[#1a1a1a]/80 rounded-full inset-shadow">
                    </div>
                    <div
                        class="absolute top-[-10px] right-[-30px] sm:right-[-34px] w-5 h-5 bg-gray-200/50 dark:bg-[#1a1a1a]/80 rounded-full inset-shadow">
                    </div>

                    <div class="flex justify-between items-end mb-5 sm:mb-6">
                        <div class="flex gap-4 sm:gap-6">
                            <div>
                                <p
                                    class="text-[9px] sm:text-[10px] text-gray-400 dark:text-gray-500 font-bold mb-1 tracking-wider">
                                    DATE</p>
                                <p class="font-bold text-sm dark:text-gray-200">Feb 21</p>
                            </div>
                            <div>
                                <p
                                    class="text-[9px] sm:text-[10px] text-gray-400 dark:text-gray-500 font-bold mb-1 tracking-wider">
                                    TIME</p>
                                <p class="font-bold text-sm dark:text-gray-200">21:55</p>
                            </div>
                        </div>
                        <p class="text-xl font-bold dark:text-white">₹1</p>
                    </div>

                    <div class="flex justify-between items-center gap-2">
                        <div class="flex flex-col opacity-40 dark:opacity-60 shrink-0 hidden sm:flex">
                            <!-- Hidden barcode on very small screens to give button space -->
                            <div class="flex gap-[1px] h-6">
                                <div class="w-[2px] bg-black dark:bg-white h-full"></div>
                                <div class="w-1 bg-black dark:bg-white h-full"></div>
                                <div class="w-[2px] bg-black dark:bg-white h-full"></div>
                                <div class="w-2 bg-black dark:bg-white h-full"></div>
                                <div class="w-[1px] bg-black dark:bg-white h-full"></div>
                                <div class="w-1 bg-black dark:bg-white h-full"></div>
                                <div class="w-[3px] bg-black dark:bg-white h-full"></div>
                                <div class="w-[1px] bg-black dark:bg-white h-full"></div>
                            </div>
                            <span
                                class="text-[8px] tracking-[0.2em] font-mono mt-1 text-gray-600 dark:text-gray-300">129394</span>
                        </div>
                        <!-- Responsive padding for button -->
                        <button
                            class="bg-[#111] dark:bg-white text-white dark:text-black px-4 sm:px-6 py-3 rounded-xl text-xs font-bold tracking-widest md:hover:bg-black dark:md:hover:bg-gray-200 active:scale-95 transition-all shadow-lg w-full sm:w-auto text-center">
                            GET PASS
                        </button>
                    </div>
                </div>
            </div>
            <!-- More cards will be generated by JS -->
        </div>

    </div>

    <!-- Floating Bottom Navigation -->
    <!-- Added max-width and adjusted padding for tiny phones -->
    <div class="fixed bottom-6 w-[90%] max-w-[280px] left-1/2 transform -translate-x-1/2 z-50">
        <div
            class="glass-card px-6 py-3 sm:py-4 rounded-full flex justify-between items-center shadow-[0_20px_40px_rgba(0,0,0,0.2)]">
            <!-- p-3 provides a minimum 44px touch target area for mobile accessibility -->
            <button class="p-3 -m-2 text-black dark:text-white transition-transform active:scale-90 md:hover:scale-110">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                    </path>
                </svg>
            </button>
            <button
                class="p-3 -m-2 text-gray-400 dark:text-gray-500 md:hover:text-black dark:md:hover:text-white transition-all active:scale-90 md:hover:scale-110">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                    </path>
                </svg>
            </button>
            <button
                class="p-3 -m-2 text-gray-400 dark:text-gray-500 md:hover:text-black dark:md:hover:text-white transition-all active:scale-90 md:hover:scale-110">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
            </button>
        </div>
    </div>

    <script>
        // --- Endless UI Scroll Generation ---
        const eventsContainer = document.getElementById('events-container');
        const sampleTitles = ["Underground Rave", "Jazz Night in the Alley", "Indie Rock Festival", "Techno Bunker", "Acoustic Sunset Session", "Neon Cyberpunk Party"];
        const sampleTags = ["MUSIC", "LIVE", "DJ SET", "CHILL", "DANCE", "VIP"];

        let cardCount = 1;
        function generateUICards(count) {
            for (let i = 0; i < count; i++) {
                const el = document.createElement('div');
                el.className = 'glass-card rounded-3xl p-5 sm:p-6 relative mt-5 sm:mt-6';
                const title = sampleTitles[Math.floor(Math.random() * sampleTitles.length)];
                const tag = sampleTags[Math.floor(Math.random() * sampleTags.length)];
                const price = Math.floor(Math.random() * 1500) + 200;

                el.innerHTML = `
                    <div class="absolute top-6 right-6 flex flex-col items-end opacity-20 dark:opacity-40">
                        <div class="flex gap-[2px] h-8">
                            <div class="w-1 bg-black dark:bg-white h-full"></div><div class="w-2 bg-black dark:bg-white h-full"></div><div class="w-[3px] bg-black dark:bg-white h-full"></div><div class="w-[1px] bg-black dark:bg-white h-full"></div><div class="w-1 bg-black dark:bg-white h-full"></div>
                        </div>
                        <span class="text-[8px] tracking-[0.2em] font-mono mt-1 dark:text-gray-300">0 4 2</span>
                    </div>
                    <h3 class="text-xl font-bold mb-3 text-gray-900 dark:text-white pr-8">${title}</h3>
                    <div class="flex items-center flex-wrap gap-2 mb-4 pr-10">
                        <svg class="w-3 h-3 text-red-500 shrink-0" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5a2.5 2.5 0 010-5 2.5 2.5 0 010 5z"/></svg>
                        <a href="#" class="text-[10px] sm:text-xs font-mono font-bold text-gray-600 dark:text-gray-400 md:hover:text-black dark:md:hover:text-white truncate max-w-[160px] sm:max-w-full">Location TBD</a>
                        <span class="px-2 py-1 bg-gray-100 dark:bg-gray-800 rounded text-[10px] font-bold text-gray-500 dark:text-gray-400 tracking-wider shrink-0">${tag}</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-6 sm:mb-8 font-medium">Join the vibe. Scan the pass at entry.</p>
                    <div class="relative pt-6">
                        <div class="absolute top-0 left-[-20px] sm:left-[-24px] right-[-20px] sm:right-[-24px] h-[1px] dashed-line"></div>
                        <div class="absolute top-[-10px] left-[-30px] sm:left-[-34px] w-5 h-5 bg-gray-200/50 dark:bg-[#1a1a1a]/80 rounded-full inset-shadow"></div>
                        <div class="absolute top-[-10px] right-[-30px] sm:right-[-34px] w-5 h-5 bg-gray-200/50 dark:bg-[#1a1a1a]/80 rounded-full inset-shadow"></div>
                        <div class="flex justify-between items-end mb-5 sm:mb-6">
                            <div class="flex gap-4 sm:gap-6">
                                <div><p class="text-[9px] sm:text-[10px] text-gray-400 dark:text-gray-500 font-bold mb-1 tracking-wider">DATE</p><p class="font-bold text-sm dark:text-gray-200">Mar 0${Math.floor(Math.random() * 9) + 1}</p></div>
                                <div><p class="text-[9px] sm:text-[10px] text-gray-400 dark:text-gray-500 font-bold mb-1 tracking-wider">TIME</p><p class="font-bold text-sm dark:text-gray-200">22:00</p></div>
                            </div>
                            <p class="text-xl font-bold dark:text-white">₹${price}</p>
                        </div>
                        <div class="flex justify-between items-center gap-2">
                            <div class="flex flex-col opacity-40 dark:opacity-60 shrink-0 hidden sm:flex">
                                <div class="flex gap-[1px] h-6">
                                    <div class="w-[2px] bg-black dark:bg-white h-full"></div><div class="w-1 bg-black dark:bg-white h-full"></div><div class="w-[2px] bg-black dark:bg-white h-full"></div><div class="w-[1px] bg-black dark:bg-white h-full"></div><div class="w-2 bg-black dark:bg-white h-full"></div>
                                </div>
                                <span class="text-[8px] tracking-[0.2em] font-mono mt-1 text-gray-600 dark:text-gray-300">${Math.floor(100000 + Math.random() * 900000)}</span>
                            </div>
                            <button class="bg-[#111] dark:bg-white text-white dark:text-black px-4 sm:px-6 py-3 rounded-xl text-xs font-bold tracking-widest md:hover:bg-black dark:md:hover:bg-gray-200 active:scale-95 transition-all shadow-lg w-full sm:w-auto text-center">GET PASS</button>
                        </div>
                    </div>
                `;
                eventsContainer.appendChild(el);
                cardCount++;
            }
        }

        // --- Procedural Graffiti Canvas Engine ---
        const canvas = document.getElementById('graffiti-canvas');
        const ctx = canvas.getContext('2d');
        let cw, ch;

        // Dynamic silhouette color based on theme
        const getSilColor = () => document.documentElement.classList.contains('dark') ? '#ffffff' : '#000000';

        const graffitiElements = [];
        let highestYGenerated = 0;

        function resizeCanvas() {
            // Cap device pixel ratio to 2 for better performance on mobile high-res screens
            const dpr = Math.min(window.devicePixelRatio || 1, 2);

            // Get actual CSS dimensions
            const cssWidth = window.innerWidth;
            const cssHeight = window.innerHeight;

            // Set internal resolution scaled by DPR
            canvas.width = cssWidth * dpr;
            canvas.height = cssHeight * dpr;

            // Keep CSS size intact
            cw = cssWidth;
            ch = cssHeight;

            // Scale context to match DPR
            ctx.scale(dpr, dpr);

            renderGraffiti();
        }
        window.addEventListener('resize', resizeCanvas);

        // --- Graffiti Art Classes ---

        class GraffitiBlob {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                // Slightly smaller elements for mobile viewability
                this.size = (Math.random() * 100 + 50) * (window.innerWidth < 600 ? 0.7 : 1);
                this.points = [];
                const numPoints = 5 + Math.floor(Math.random() * 5);

                for (let i = 0; i < numPoints; i++) {
                    const angle = (i / numPoints) * Math.PI * 2;
                    // Create distorted bubbly shapes
                    const radius = this.size * (0.5 + Math.random() * 0.7);
                    this.points.push({
                        x: Math.cos(angle) * radius,
                        y: Math.sin(angle) * radius
                    });
                }
                this.hasDrip = Math.random() > 0.6;
            }

            draw(ctx, scrollY) {
                const drawY = this.y - scrollY;
                if (drawY < -this.size * 2 || drawY > ch + this.size * 2) return;

                const drawShape = () => {
                    ctx.beginPath();
                    let startX = this.x + this.points[0].x;
                    let startY = drawY + this.points[0].y;
                    ctx.moveTo(startX, startY);

                    for (let i = 0; i < this.points.length; i++) {
                        let curr = this.points[i];
                        let next = this.points[(i + 1) % this.points.length];
                        let mx = this.x + (curr.x + next.x) / 2;
                        let my = drawY + (curr.y + next.y) / 2;
                        ctx.quadraticCurveTo(this.x + curr.x, drawY + curr.y, mx, my);
                    }
                    ctx.closePath();
                };

                // Solid silhouette fill
                ctx.fillStyle = getSilColor();
                drawShape();
                ctx.fill();

                // Drips
                if (this.hasDrip) {
                    ctx.fillStyle = getSilColor();
                    ctx.strokeStyle = getSilColor();
                    ctx.lineWidth = Math.random() * 6 + 3;

                    const dripX = this.x + (Math.random() * this.size - this.size / 2);
                    const dripLength = Math.random() * 50 + 20;
                    const dripY = drawY + this.size * 0.4;

                    ctx.beginPath();
                    ctx.lineCap = 'round';
                    ctx.moveTo(dripX, dripY);
                    ctx.lineTo(dripX, dripY + dripLength);
                    ctx.stroke();

                    // Drop at bottom
                    ctx.beginPath();
                    ctx.arc(dripX, dripY + dripLength + 8, ctx.lineWidth / 1.5, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
        }

        class GraffitiSpray {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = (Math.random() * 80 + 40) * (window.innerWidth < 600 ? 0.8 : 1);
                this.dots = [];
                // Fewer dots on mobile to improve render performance
                const numDots = window.innerWidth < 600 ? 30 : 50;
                for (let i = 0; i < numDots; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const r = Math.random() * this.radius;
                    this.dots.push({
                        dx: Math.cos(angle) * r,
                        dy: Math.sin(angle) * r,
                        size: Math.random() * 5 + 2,
                        opacity: Math.random() * 0.8 + 0.2
                    });
                }
            }

            draw(ctx, scrollY) {
                const drawY = this.y - scrollY;
                if (drawY < -this.radius || drawY > ch + this.radius) return;

                ctx.fillStyle = getSilColor();
                this.dots.forEach(dot => {
                    ctx.beginPath();
                    ctx.arc(this.x + dot.dx, drawY + dot.dy, dot.size, 0, Math.PI * 2);
                    ctx.globalAlpha = dot.opacity;
                    ctx.fill();
                });
                ctx.globalAlpha = 1.0; // reset
            }
        }

        class GraffitiText {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                const words = ["GIG", "CITY", "VIBE", "ART", "BASS", "WILD", "ROCK", "a", "G", "Z"];
                this.text = words[Math.floor(Math.random() * words.length)];
                this.fontSize = (Math.floor(Math.random() * 120) + 60) * (window.innerWidth < 600 ? 0.7 : 1);
                this.angle = (Math.random() - 0.5) * 0.4;
            }

            draw(ctx, scrollY) {
                const drawY = this.y - scrollY;
                if (drawY < -this.fontSize || drawY > ch + this.fontSize) return;

                ctx.save();
                ctx.translate(this.x, drawY);
                ctx.rotate(this.angle);

                ctx.font = `900 ${this.fontSize}px 'Permanent Marker', 'Inter', cursive`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // Pure silhouette text
                ctx.fillStyle = getSilColor();
                ctx.fillText(this.text, 0, 0);

                ctx.restore();
            }
        }

        function generateGraffitiUpTo(targetY) {
            // Buffer to generate ahead of scrolling
            const buffer = 1500;
            while (highestYGenerated < targetY + buffer) {
                const x = Math.random() * cw;
                const y = highestYGenerated + (Math.random() * 100 - 20); // dense packing

                const rand = Math.random();
                if (rand < 0.2) {
                    graffitiElements.push(new GraffitiSpray(x, y));
                } else if (rand < 0.6) {
                    graffitiElements.push(new GraffitiBlob(x, y));
                } else {
                    graffitiElements.push(new GraffitiText(x, y));
                }

                highestYGenerated += Math.random() * 150 + 50; // Step down for next element
            }
        }

        function renderGraffiti() {
            ctx.clearRect(0, 0, cw, ch);
            const scrollY = window.scrollY;

            // Generate new art if we scroll near the bottom
            generateGraffitiUpTo(scrollY + ch);

            // Draw all elements (they self-cull if out of bounds)
            graffitiElements.forEach(el => el.draw(ctx, scrollY));
        }

        // --- Init and Event Listeners ---

        // Initial setup
        resizeCanvas();
        generateUICards(5); // Pre-fill some UI cards to allow scrolling

        // Theme Toggle Logic
        const themeBtn = document.getElementById('theme-toggle');
        themeBtn.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            // Re-render canvas immediately to switch silhouette colors
            renderGraffiti();
        });

        // Scroll listener with requestAnimationFrame throttling for mobile performance
        let isTicking = false;
        window.addEventListener('scroll', () => {
            if (!isTicking) {
                window.requestAnimationFrame(() => {
                    renderGraffiti();

                    // Endless UI scrolling logic
                    const scrolledToBottom = (window.innerHeight + window.scrollY) >= document.body.offsetHeight - 500;
                    if (scrolledToBottom && cardCount < 50) { // Limit to 50 cards for demo
                        generateUICards(3);
                    }
                    isTicking = false;
                });
                isTicking = true;
            }
        }, { passive: true }); // passive flag for better scroll performance

        // Trigger first render
        renderGraffiti();

    </script>
</body>

</html>